<UserControl x:Class="SimElation.SimHubIntegration.SliProPlugin.SettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins"
			 xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
			 xmlns:slipro="clr-namespace:SimElation.SliPro"
			 xmlns:local="clr-namespace:SimElation.SimHubIntegration.SliProPlugin"
			 xmlns:autogrid="clr-namespace:WpfAutoGrid;assembly=WpfAutoGrid"
			 mc:Ignorable="d"
			 d:DesignWidth="600" d:DesignHeight="800">
	<UserControl.Resources>
		<local:AllowNullConverter x:Key="AllowNullConverter" />
		<local:RotaryDetectConverter x:Key="RotaryDetectConverter" />
		<local:NotConverter x:Key="NotConverter" />
	</UserControl.Resources>
	
	<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
		<StackPanel Orientation="Vertical">
			<styles:SHSection Title="{Binding Title}">
				<StackPanel Orientation="Vertical">
					<styles:SHLinkButtonSmall HorizontalAlignment="Left" Click="OnHelpClick">Help</styles:SHLinkButtonSmall>
					<Image Source="..\assets\SLI-PRO-RevA.png" Stretch="None" MouseDown="OnSliProClick" Margin="0,20,0,20"/>
				</StackPanel>
			</styles:SHSection>
			
			<styles:SHSection Title="SEGMENT DISPLAYS">
				<UniformGrid Rows="1" Columns="2">
					<local:SegmentDisplayControl Label="Left display"
												 IsRotaryControlled="{Binding Path=Settings.IsLeftSegmentDisplayRotaryControlled, Mode=TwoWay}"
												 LearnRotaryButtonContent="{Binding Path=Settings.SliProSettings.RotarySwitchOffsets[(slipro:RotarySwitch)leftSegment],
													 Converter={StaticResource RotaryDetectConverter}}"
				 								 ItemsSource="{Binding LeftSegmentDisplayComboBoxContents}"
												 SelectedIndex="{Binding Path=Settings.LeftSegmentDisplayIndex, Mode=TwoWay}"
												 LearnRotaryClick="OnLeftSegmentRotaryClick"
												 NextDisplay="{x:Static Member=local:SettingsControl.LeftSegmentDisplayNextAction}"
												 PreviousDisplay="{x:Static Member=local:SettingsControl.LeftSegmentDisplayPreviousAction}"/>

					<local:SegmentDisplayControl Label="Right display"
												 IsRotaryControlled="{Binding Path=Settings.IsRightSegmentDisplayRotaryControlled, Mode=TwoWay}"
												 LearnRotaryButtonContent="{Binding Path=Settings.SliProSettings.RotarySwitchOffsets[(slipro:RotarySwitch)rightSegment],
													 Converter={StaticResource RotaryDetectConverter}}"
												 ItemsSource="{Binding RightSegmentDisplayComboBoxContents}"
												 SelectedIndex="{Binding Path=Settings.RightSegmentDisplayIndex, Mode=TwoWay}"
												 LearnRotaryClick="OnRightSegmentRotaryClick"
												 NextDisplay="{x:Static Member=local:SettingsControl.RightSegmentDisplayNextAction}"
												 PreviousDisplay="{x:Static Member=local:SettingsControl.RightSegmentDisplayPreviousAction}"/>
				</UniformGrid>
			</styles:SHSection>

			<styles:SHSection Title="DISPLAY BRIGHTNESS">
				<autogrid:AutoGrid RowCount="2" Columns="200,28,172">
					<Label VerticalAlignment="Center" Margin="4,4,4,4" Content="Rotary control"/>
					<styles:SHToggleButton HorizontalAlignment="Left" Margin="4,4,4,4"
										   IsChecked="{Binding Path=Settings.SliProSettings.IsBrightnessRotaryControlled, Mode=TwoWay}"/>
					<styles:SHButtonPrimary VerticalAlignment="Center" Margin="20,4,4,4" x:Name="learnRotaryButton"
											IsEnabled="{Binding Path=Settings.SliProSettings.IsBrightnessRotaryControlled}"
											Click="OnBrightnessRotaryClick"
											Content="{Binding Path=Settings.SliProSettings.RotarySwitchOffsets[(slipro:RotarySwitch)brightness],
												Converter={StaticResource RotaryDetectConverter}, ConverterParameter='brightness'}"
											ToolTip="Learn or forget a rotary switch attached to the SLI-Pro to control the brightness." />

					<Label HorizontalAlignment="Left" VerticalAlignment="Center" Margin="4,4,4,4" Content="Brightness level" />
					<Slider Minimum="1" Maximum="254" VerticalAlignment="Center" Grid.ColumnSpan="2" Margin="4,4,4,4"
							IsEnabled="{Binding Path=Settings.SliProSettings.IsBrightnessRotaryControlled, Converter={StaticResource NotConverter}}"
							Value="{Binding Path=Settings.SliProSettings.BrightnessLevel, Mode=TwoWay,
								Converter={StaticResource AllowNullConverter}}"/>
				</autogrid:AutoGrid>
			</styles:SHSection>

			<styles:SHSection Title="CONFIGURATION">
				<autogrid:AutoGrid RowCount="5" Columns="200,200">
					<Label VerticalAlignment="Center" Margin="4,4,4,4" Content="Welcome message" />
					<TextBox Margin="4,4,4,4" VerticalAlignment="Center"
							 Text="{Binding Path=Settings.WelcomeMessage, Mode=TwoWay}"
							 ToolTip="Text to display using the segment displays when SimHub is running but no game is." />

					<Label VerticalAlignment="Center" Margin="4,4,4,4" Content="Pit lane animation speed (ms)" />
					<mah:NumericUpDown Minimum="0" Maximum="20000" HasDecimals="False" Margin="4,4,4,4"
									   VerticalAlignment="Center"
									   Value="{Binding Path=Settings.PitLaneAnimationSpeedMs, Mode=TwoWay}"
									   ToolTip="The rate in milliseconds at which to animate the RPM LEDs when in the pitlane. 0 to disable." />

					<Label VerticalAlignment="Center" Margin="4,4,4,4" Content="Shift point blink on time (ms)" />
					<mah:NumericUpDown Minimum="0" Maximum="20000" HasDecimals="False" Margin="4,4,4,4"
									   VerticalAlignment="Center"
									   Value="{Binding Path=Settings.ShiftPointBlinkOnSpeedMs, Mode=TwoWay}"
									   ToolTip="How long in milliseconds to light the RPM LEDs when at or above the shift threshold." />

					<Label VerticalAlignment="Center" Margin="4,4,4,4" Content="Shift point blink off time (ms)" />
					<mah:NumericUpDown Minimum="0" Maximum="20000" HasDecimals="False" Margin="4,4,4,4"
									   VerticalAlignment="Center"
									   Value="{Binding Path=Settings.ShiftPointBlinkOffSpeedMs, Mode=TwoWay}"
									   ToolTip="How long in milliseconds to blank the RPM LEDs when at or above the shift threshold." />

					<Label VerticalAlignment="Center" Margin="4,4,4,4" Content="Show new segment title for (ms)" />
					<mah:NumericUpDown Minimum="0" Maximum="60000" HasDecimals="False" Margin="4,4,4,4"
									   VerticalAlignment="Center"
									   Value="{Binding Path=Settings.SegmentNameTimeoutMs, Mode=TwoWay}"
									   ToolTip="How long to display what information a segment display will show after changing mode." />
				</autogrid:AutoGrid>
			</styles:SHSection>
		</StackPanel>
	</ScrollViewer>
</UserControl>
